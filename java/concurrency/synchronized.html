<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.13" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.48" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://leslie-dd.github.io/leslie-blog/leslie-blog/java/concurrency/synchronized.html"><meta property="og:site_name" content="Evan çš„åšå®¢"><meta property="og:title" content="å…³é”®å­— synchronized è¯¦è§£"><meta property="og:description" content="åœ¨ C ç¨‹åºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”æ¥å®ç°åŒæ­¥å—çš„äº’æ–¥è®¿é—®åŠçº¿ç¨‹çš„é˜»å¡åŠå”¤é†’ç­‰å·¥ä½œã€‚åœ¨ Java ä¸­é™¤äº†æä¾› Lock API å¤–è¿˜åœ¨è¯­æ³•å±‚é¢ä¸Šæä¾›äº† synchronized å…³é”®å­—æ¥å®ç°äº’æ–¥åŒæ­¥åŸè¯­, æœ¬æ–‡å°†å¯¹ synchronized å…³é”®å­—è¯¦ç»†åˆ†æã€‚ å¸¦ç€ BAT å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£ synchronized synchroni..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-03-23T19:00:21.000Z"><meta property="article:author" content="Evan"><meta property="article:tag" content="Java"><meta property="article:published_time" content="2025-03-24T00:00:00.000Z"><meta property="article:modified_time" content="2025-03-23T19:00:21.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"å…³é”®å­— synchronized è¯¦è§£","image":[""],"datePublished":"2025-03-24T00:00:00.000Z","dateModified":"2025-03-23T19:00:21.000Z","author":[{"@type":"Person","name":"Evan"}]}</script><script src="/js/base.js"></script><title>å…³é”®å­— synchronized è¯¦è§£ | Evan çš„åšå®¢</title><meta name="description" content="åœ¨ C ç¨‹åºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”æ¥å®ç°åŒæ­¥å—çš„äº’æ–¥è®¿é—®åŠçº¿ç¨‹çš„é˜»å¡åŠå”¤é†’ç­‰å·¥ä½œã€‚åœ¨ Java ä¸­é™¤äº†æä¾› Lock API å¤–è¿˜åœ¨è¯­æ³•å±‚é¢ä¸Šæä¾›äº† synchronized å…³é”®å­—æ¥å®ç°äº’æ–¥åŒæ­¥åŸè¯­, æœ¬æ–‡å°†å¯¹ synchronized å…³é”®å­—è¯¦ç»†åˆ†æã€‚ å¸¦ç€ BAT å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£ synchronized synchroni...">
    <link rel="preload" href="/leslie-blog/assets/style-BMKGoIKn.css" as="style"><link rel="stylesheet" href="/leslie-blog/assets/style-BMKGoIKn.css">
    <link rel="modulepreload" href="/leslie-blog/assets/app-BJKu-9y2.js"><link rel="modulepreload" href="/leslie-blog/assets/synchronized.html-B4cHzy5L.js"><link rel="modulepreload" href="/leslie-blog/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/leslie-blog/"><img class="vp-nav-logo" src="/leslie-blog/images/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Evan çš„åšå®¢</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/leslie-blog/" aria-label="ä¸»é¡µ"><!--[--><span class="font-icon icon home" style=""></span><!--]-->ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="å…³äº"><!--[--><!---->å…³äº<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/about/me/self_intro.html" aria-label="About Me"><!---->About Me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/about/site/" aria-label="About this site"><!---->About this site<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ•™ç¨‹"><!--[--><!---->æ•™ç¨‹<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/tutorial/linux/" aria-label="Linux"><!---->Linux<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/tutorial/mac/" aria-label="Mac"><!---->Mac<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/tutorial/android/" aria-label="Android"><!---->Android<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/tutorial/server/" aria-label="Server"><!---->Server<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/tutorial/git_github_tips.html" aria-label="Git &amp; GitHub"><!---->Git &amp; GitHub<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/tutorial/regex.html" aria-label="Regex"><!---->Regex<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Java"><!--[--><!---->Java<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/java/JavaException.html" aria-label="Java Exception"><!---->Java Exception<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/leslie-blog/java/concurrency/" aria-label="Java Concurrency"><!---->Java Concurrency<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/leslie-blog/android/" aria-label="Android"><!---->Android<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æŠ€æœ¯åšå®¢"><!--[--><!---->æŠ€æœ¯åšå®¢<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/blog/computer/" aria-label="è®¡ç®—æœºåŸºç¡€"><!---->è®¡ç®—æœºåŸºç¡€<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/blog/server/" aria-label="åç«¯"><!---->åç«¯<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/blog/databases/" aria-label="æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/blog/python/" aria-label="Python"><!---->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="æ•°æ®ç»“æ„"><!--[--><!---->æ•°æ®ç»“æ„<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/datastructure/tree/" aria-label="ğŸŒ³ æ ‘"><!---->ğŸŒ³ æ ‘<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="ç®—æ³•"><!--[--><!---->ç®—æ³•<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/algorithms/sort/" aria-label="æ’åºç®—æ³•"><!---->æ’åºç®—æ³•<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="é¡¹ç›®"><!--[--><!---->é¡¹ç›®<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/projects/reading/" aria-label="Reading"><!---->Reading<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/leslie-blog/projects/passwd/" aria-label="Passwd"><!---->Passwd<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/leslie-blog/notes/" aria-label="è¯»ä¹¦ç¬”è®°"><!---->è¯»ä¹¦ç¬”è®°<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/Leslie-DD/leslie-blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><!----><span class="vp-sidebar-title">Java</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/JavaException.html" aria-label="Java Exception"><!---->Java Exception<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/leslie-blog/java/concurrency/" aria-label="Java Concurrency"><!---->Java Concurrency<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/leslie-blog/java/concurrency/synchronized.html" aria-label="å…³é”®å­— synchronized è¯¦è§£"><!---->å…³é”®å­— synchronized è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/concurrency/volatile.html" aria-label="å…³é”®å­— volatile è¯¦è§£"><!---->å…³é”®å­— volatile è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/concurrency/final.html" aria-label="å…³é”®å­— final è¯¦è§£"><!---->å…³é”®å­— final è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/concurrency/memorybarrier.html" aria-label="å†…å­˜å±éšœ"><!---->å†…å­˜å±éšœ<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/concurrency/java_double_check_single_instance.html" aria-label="å•ä¾‹æ¨¡å¼åŒæ£€é”"><!---->å•ä¾‹æ¨¡å¼åŒæ£€é”<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/concurrency/ThreadLocal.html" aria-label="ThreadLocal è¯¦è§£"><!---->ThreadLocal è¯¦è§£<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/leslie-blog/java/concurrency/ThreadLocalJavaGuide.html" aria-label="ThreadLocal è¯¦è§£ - Java Guide"><!---->ThreadLocal è¯¦è§£ - Java Guide<!----></a></li></ul></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->å…³é”®å­— synchronized è¯¦è§£</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Evan</span></span><span property="author" content="Evan"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-03-24T00:00:00.000Z"></span><!----><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">Java</span><!--]--><meta property="keywords" content="Java"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 26 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT26M"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å¸¦ç€-bat-å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£-synchronized">å¸¦ç€ BAT å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£ synchronized</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#synchronized-çš„ä½¿ç”¨">synchronized çš„ä½¿ç”¨</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯¹è±¡é”">å¯¹è±¡é”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç±»é”">ç±»é”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#synchronized-åŸç†åˆ†æ">synchronized åŸç†åˆ†æ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†">åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯é‡å…¥åŸç†-åŠ é”æ¬¡æ•°è®¡æ•°å™¨">å¯é‡å…¥åŸç†ï¼šåŠ é”æ¬¡æ•°è®¡æ•°å™¨</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¿è¯å¯è§æ€§çš„åŸç†-å†…å­˜æ¨¡å‹å’Œ-happens-before-è§„åˆ™">ä¿è¯å¯è§æ€§çš„åŸç†ï¼šå†…å­˜æ¨¡å‹å’Œ happens-before è§„åˆ™</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#jvm-ä¸­é”çš„ä¼˜åŒ–">JVM ä¸­é”çš„ä¼˜åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é”çš„ç±»å‹">é”çš„ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”">è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é”æ¶ˆé™¤">é”æ¶ˆé™¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é”ç²—åŒ–">é”ç²—åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è½»é‡çº§é”">è½»é‡çº§é”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åå‘é”">åå‘é”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”">é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#synchronized-ä¸-lock">synchronized ä¸ Lock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#synchronized-çš„ç¼ºé™·">synchronized çš„ç¼ºé™·</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lock-è§£å†³ç›¸åº”é—®é¢˜">Lock è§£å†³ç›¸åº”é—®é¢˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å†æ·±å…¥ç†è§£">å†æ·±å…¥ç†è§£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><blockquote><p>åœ¨ C ç¨‹åºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„äº’æ–¥é”æ¥å®ç°åŒæ­¥å—çš„äº’æ–¥è®¿é—®åŠçº¿ç¨‹çš„é˜»å¡åŠå”¤é†’ç­‰å·¥ä½œã€‚åœ¨ Java ä¸­é™¤äº†æä¾› Lock API å¤–è¿˜åœ¨è¯­æ³•å±‚é¢ä¸Šæä¾›äº† synchronized å…³é”®å­—æ¥å®ç°äº’æ–¥åŒæ­¥åŸè¯­, æœ¬æ–‡å°†å¯¹ synchronized å…³é”®å­—è¯¦ç»†åˆ†æã€‚</p></blockquote><h2 id="å¸¦ç€-bat-å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£-synchronized" tabindex="-1"><a class="header-anchor" href="#å¸¦ç€-bat-å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£-synchronized"><span>å¸¦ç€ BAT å¤§å‚çš„é¢è¯•é—®é¢˜å»ç†è§£ synchronized</span></a></h2><ul><li>synchronized å¯ä»¥ä½œç”¨åœ¨å“ªé‡Œ? åˆ†åˆ«é€šè¿‡<code>å¯¹è±¡é”</code>å’Œ<code>ç±»é”</code>è¿›è¡Œä¸¾ä¾‹ã€‚</li><li>synchronized æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ä»€ä¹ˆä¿è¯çº¿ç¨‹å®‰å…¨çš„? åˆ†ä¸‰ä¸ªæ–¹é¢å›ç­”ï¼šåŠ é”å’Œé‡Šæ”¾é”çš„åŸç†ï¼Œå¯é‡å…¥åŸç†ï¼Œä¿è¯å¯è§æ€§åŸç†ã€‚</li><li>synchronized æœ‰ä»€ä¹ˆæ ·çš„ç¼ºé™·? Java Lock æ˜¯æ€ä¹ˆå¼¥è¡¥è¿™äº›ç¼ºé™·çš„ã€‚</li><li>synchronized å’Œ Lock çš„å¯¹æ¯”ï¼Œå’Œé€‰æ‹©?</li><li>synchronized åœ¨ä½¿ç”¨æ—¶æœ‰ä½•æ³¨æ„äº‹é¡¹?</li><li>synchronized ä¿®é¥°çš„æ–¹æ³•åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶,ä¼šé‡Šæ”¾é”å—? <blockquote><p>synchronized ä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”</p></blockquote></li><li>å¤šä¸ªçº¿ç¨‹ç­‰å¾…åŒä¸€ä¸ª synchronized é”çš„æ—¶å€™ï¼ŒJVM å¦‚ä½•é€‰æ‹©ä¸‹ä¸€ä¸ªè·å–é”çš„çº¿ç¨‹? <blockquote><p>æ–°æ¥çš„çº¿ç¨‹æœ‰å¯èƒ½ç«‹å³è·å¾—ç›‘è§†å™¨ï¼Œè€Œåœ¨ç­‰å¾…åŒºä¸­ç­‰å€™å·²ä¹…çš„çº¿ç¨‹å¯èƒ½å†æ¬¡ç­‰å¾…ï¼Œè¿™æ ·æœ‰åˆ©äºæé«˜æ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´é¥¥é¥¿ç°è±¡ã€‚</p></blockquote></li><li>synchronized ä½¿å¾—åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œï¼Œæ€§èƒ½æ¯”è¾ƒå·®ï¼Œæœ‰ä»€ä¹ˆæå‡çš„æ–¹æ³•?</li><li>æˆ‘æƒ³æ›´åŠ çµæ´»çš„æ§åˆ¶é”çš„é‡Šæ”¾å’Œè·å–(ç°åœ¨é‡Šæ”¾é”å’Œè·å–é”çš„æ—¶æœºéƒ½è¢«è§„å®šæ­»äº†)ï¼Œæ€ä¹ˆåŠ?</li><li>ä»€ä¹ˆæ˜¯é”çš„å‡çº§å’Œé™çº§? ä»€ä¹ˆæ˜¯ JVM é‡Œçš„åæ–œé”ã€è½»é‡çº§é”ã€é‡é‡çº§é”?</li><li>ä¸åŒçš„ JDK ä¸­å¯¹ synchronized æœ‰ä½•ä¼˜åŒ–?</li></ul><h2 id="synchronized-çš„ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#synchronized-çš„ä½¿ç”¨"><span>synchronized çš„ä½¿ç”¨</span></a></h2><p>åœ¨åº”ç”¨ sychronized å…³é”®å­—æ—¶éœ€è¦æŠŠæ¡å¦‚ä¸‹æ³¨æ„ç‚¹ï¼š</p><ul><li>ä¸€æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼›</li><li>æ¯ä¸ªå®ä¾‹éƒ½å¯¹åº”æœ‰è‡ªå·±çš„ä¸€æŠŠé”(this),ä¸åŒå®ä¾‹ä¹‹é—´äº’ä¸å½±å“ï¼›ä¾‹å¤–ï¼šé”å¯¹è±¡æ˜¯*.classä»¥åŠ synchronized ä¿®é¥°çš„æ˜¯ static æ–¹æ³•çš„æ—¶å€™ï¼Œæ‰€æœ‰å¯¹è±¡å…¬ç”¨åŒä¸€æŠŠé”</li><li>synchronized ä¿®é¥°çš„æ–¹æ³•ï¼Œæ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½ä¼šé‡Šæ”¾é”</li></ul><h3 id="å¯¹è±¡é”" tabindex="-1"><a class="header-anchor" href="#å¯¹è±¡é”"><span>å¯¹è±¡é”</span></a></h3><p>åŒ…æ‹¬æ–¹æ³•é”(é»˜è®¤é”å¯¹è±¡ä¸º thisï¼Œå½“å‰å®ä¾‹å¯¹è±¡)å’ŒåŒæ­¥ä»£ç å—é”(è‡ªå·±æŒ‡å®šé”å¯¹è±¡)</p><h4 id="ä»£ç å—å½¢å¼-æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡-ä¹Ÿå¯æ˜¯æ˜¯this-ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”" tabindex="-1"><a class="header-anchor" href="#ä»£ç å—å½¢å¼-æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡-ä¹Ÿå¯æ˜¯æ˜¯this-ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”"><span>ä»£ç å—å½¢å¼ï¼šæ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡ï¼Œä¹Ÿå¯æ˜¯æ˜¯this,ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”</span></a></h4><ul><li>ç¤ºä¾‹1</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // åŒæ­¥ä»£ç å—å½¢å¼â€”â€”é”ä¸ºthis,ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨çš„é”æ˜¯ä¸€æ ·çš„,çº¿ç¨‹1å¿…é¡»è¦ç­‰åˆ°çº¿ç¨‹0é‡Šæ”¾äº†è¯¥é”åï¼Œæ‰èƒ½æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">æˆ‘æ˜¯çº¿ç¨‹Thread</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Thread</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">0ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">æˆ‘æ˜¯çº¿ç¨‹Thread</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Thread</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">1ç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¤ºä¾‹2</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // åˆ›å»º2æŠŠé”</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> block1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> block2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // è¿™ä¸ªä»£ç å—ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€æŠŠé”ï¼Œå½“ä»–é‡Šæ”¾åï¼Œåé¢çš„ä»£ç å—ç”±äºä½¿ç”¨çš„æ˜¯ç¬¬äºŒæŠŠé”ï¼Œå› æ­¤å¯ä»¥é©¬ä¸Šæ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (block1) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;block1é”,æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;block1é”,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (block2) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;block2é”,æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;block2é”,&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block1é”,Thread-0ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-0ã€€ã€€// å¯ä»¥çœ‹åˆ°å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ®µåŒæ­¥ä»£ç å—ä¹‹åï¼Œç¬¬äºŒä¸ªåŒæ­¥ä»£ç å—å¯ä»¥é©¬ä¸Šå¾—åˆ°æ‰§è¡Œï¼Œå› ä¸ºä»–ä»¬ä½¿ç”¨çš„é”ä¸æ˜¯åŒä¸€æŠŠ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block2é”,Thread-0ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block1é”,Thread-1ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">block2é”,Thread-1ç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ–¹æ³•é”å½¢å¼-synchronized-ä¿®é¥°æ™®é€šæ–¹æ³•-é”å¯¹è±¡é»˜è®¤ä¸ºthis" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•é”å½¢å¼-synchronized-ä¿®é¥°æ™®é€šæ–¹æ³•-é”å¯¹è±¡é»˜è®¤ä¸ºthis"><span>æ–¹æ³•é”å½¢å¼ï¼šsynchronized ä¿®é¥°æ™®é€šæ–¹æ³•ï¼Œé”å¯¹è±¡é»˜è®¤ä¸ºthis</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-0ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-1ç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç±»é”" tabindex="-1"><a class="header-anchor" href="#ç±»é”"><span>ç±»é”</span></a></h3><p>æŒ‡ synchronize ä¿®é¥°é™æ€çš„æ–¹æ³•æˆ–æŒ‡å®šé”å¯¹è±¡ä¸º Class å¯¹è±¡.</p><h4 id="synchronize-ä¿®é¥°é™æ€æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#synchronize-ä¿®é¥°é™æ€æ–¹æ³•"><span>synchronize ä¿®é¥°é™æ€æ–¹æ³•</span></a></h4><ul><li>ç¤ºä¾‹ 1ï¼ˆæ™®é€šæ–¹æ³•ï¼‰</li></ul><p>synchronized ç”¨åœ¨æ™®é€šæ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯ thisï¼Œå½“å‰å®ä¾‹</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // synchronizedç”¨åœ¨æ™®é€šæ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯thisï¼Œå½“å‰å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // t1å’Œt2å¯¹åº”çš„thisæ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä¾‹ï¼Œæ‰€ä»¥ä»£ç ä¸ä¼šä¸²è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance2);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-1ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-0ç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>ç¤ºä¾‹ 2ï¼ˆé™æ€æ–¹æ³•ï¼‰</li></ul><p>synchronized ç”¨åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯å½“å‰æ‰€åœ¨çš„ Class ç±»ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å“ªä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œéœ€è¦çš„é”éƒ½åªæœ‰ä¸€æŠŠ</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // synchronizedç”¨åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯å½“å‰æ‰€åœ¨çš„Classç±»ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å“ªä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œéœ€è¦çš„é”éƒ½åªæœ‰ä¸€æŠŠ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance2);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-0ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-1ç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="synchronized-æŒ‡å®šé”å¯¹è±¡ä¸º-class-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#synchronized-æŒ‡å®šé”å¯¹è±¡ä¸º-class-å¯¹è±¡"><span>synchronized æŒ‡å®šé”å¯¹è±¡ä¸º Class å¯¹è±¡</span></a></h4><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Runnable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> instance2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        // æ‰€æœ‰çº¿ç¨‹éœ€è¦çš„é”éƒ½æ˜¯åŒä¸€æŠŠ</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">SynchronizedObjectLock</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sleep</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">InterruptedException</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">                e</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">printStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">            System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;ç»“æŸ&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(instance2);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-0ç»“æŸ</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">æˆ‘æ˜¯çº¿ç¨‹Thread-1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">Thread-1ç»“æŸ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="synchronized-åŸç†åˆ†æ" tabindex="-1"><a class="header-anchor" href="#synchronized-åŸç†åˆ†æ"><span>synchronized åŸç†åˆ†æ</span></a></h2><h3 id="åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†" tabindex="-1"><a class="header-anchor" href="#åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†"><span>åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†</span></a></h3><blockquote><p>ç°è±¡ã€æ—¶æœº(å†…ç½®é” this)ã€æ·±å…¥ JVM çœ‹å­—èŠ‚ç (åç¼–è¯‘çœ‹ monitor æŒ‡ä»¤)</p></blockquote><p>æ·±å…¥ JVM çœ‹å­—èŠ‚ç ï¼Œåˆ›å»ºå¦‚ä¸‹çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> synchronizedDemo2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> object </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        synchronized</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (object) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        method2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ javac å‘½ä»¤è¿›è¡Œç¼–è¯‘ç”Ÿæˆ .class æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">javac</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> synchronizedDemo2.java</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ä½¿ç”¨ javap å‘½ä»¤åç¼–è¯‘æŸ¥çœ‹ .class æ–‡ä»¶çš„ä¿¡æ¯</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">javap</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -verbose</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> synchronizedDemo2.class</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å¾—åˆ°å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-x1-ByrIkz50.png" alt=""></p><p>å…³æ³¨çº¢è‰²æ–¹æ¡†é‡Œçš„<code>monitorenter</code>å’Œ<code>monitorexit</code>å³å¯ã€‚</p><p><code>Monitorenter</code>å’Œ<code>Monitorexit</code>æŒ‡ä»¤ï¼Œä¼šè®©å¯¹è±¡åœ¨æ‰§è¡Œï¼Œä½¿å…¶é”è®¡æ•°å™¨åŠ  1æˆ–è€…å‡ 1ã€‚æ¯ä¸€ä¸ªå¯¹è±¡åœ¨åŒä¸€æ—¶é—´åªä¸ä¸€ä¸ª monitor(é”)ç›¸å…³è”ï¼Œè€Œä¸€ä¸ª monitor åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å¾—ï¼Œä¸€ä¸ªå¯¹è±¡åœ¨å°è¯•è·å¾—ä¸è¿™ä¸ªå¯¹è±¡ç›¸å…³è”çš„ Monitor é”çš„æ‰€æœ‰æƒçš„æ—¶å€™ï¼Œmonitorenter æŒ‡ä»¤ä¼šå‘ç”Ÿå¦‚ä¸‹3ä¸­æƒ…å†µä¹‹ä¸€ï¼š</p><ul><li>monitor è®¡æ•°å™¨ä¸º 0ï¼Œæ„å‘³ç€ç›®å‰è¿˜æ²¡æœ‰è¢«è·å¾—ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹å°±ä¼šç«‹åˆ»è·å¾—ç„¶åæŠŠé”è®¡æ•°å™¨ +1ï¼Œä¸€æ—¦ +1ï¼Œåˆ«çš„çº¿ç¨‹å†æƒ³è·å–ï¼Œå°±éœ€è¦ç­‰å¾…</li><li>å¦‚æœè¿™ä¸ª monitor å·²ç»æ‹¿åˆ°äº†è¿™ä¸ªé”çš„æ‰€æœ‰æƒï¼Œåˆé‡å…¥äº†è¿™æŠŠé”ï¼Œé‚£é”è®¡æ•°å™¨å°±ä¼šç´¯åŠ ï¼Œå˜æˆ2ï¼Œå¹¶ä¸”éšç€é‡å…¥çš„æ¬¡æ•°ï¼Œä¼šä¸€ç›´ç´¯åŠ </li><li>è¿™æŠŠé”å·²ç»è¢«åˆ«çš„çº¿ç¨‹è·å–äº†ï¼Œç­‰å¾…é”é‡Šæ”¾</li></ul><p><code>monitorexit æŒ‡ä»¤</code>ï¼šé‡Šæ”¾å¯¹äº monitor çš„æ‰€æœ‰æƒï¼Œé‡Šæ”¾è¿‡ç¨‹å¾ˆç®€å•ï¼Œå°±æ˜¯è®² monitor çš„è®¡æ•°å™¨å‡ 1ï¼Œå¦‚æœå‡å®Œä»¥åï¼Œè®¡æ•°å™¨ä¸æ˜¯ 0ï¼Œåˆ™ä»£è¡¨åˆšæ‰æ˜¯é‡å…¥è¿›æ¥çš„ï¼Œå½“å‰çº¿ç¨‹è¿˜ç»§ç»­æŒæœ‰è¿™æŠŠé”çš„æ‰€æœ‰æƒï¼Œå¦‚æœè®¡æ•°å™¨å˜æˆ 0ï¼Œåˆ™ä»£è¡¨å½“å‰çº¿ç¨‹ä¸å†æ‹¥æœ‰è¯¥ monitor çš„æ‰€æœ‰æƒï¼Œå³é‡Šæ”¾é”ã€‚</p><p>ä¸‹å›¾è¡¨ç°äº†å¯¹è±¡ï¼Œå¯¹è±¡ç›‘è§†å™¨ï¼ŒåŒæ­¥é˜Ÿåˆ—ä»¥åŠæ‰§è¡Œçº¿ç¨‹çŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-2-C18DL9yU.png" alt=""></p><p>è¯¥å›¾å¯ä»¥çœ‹å‡ºï¼Œä»»æ„çº¿ç¨‹å¯¹ Object çš„è®¿é—®ï¼Œé¦–å…ˆè¦è·å¾— Object çš„ç›‘è§†å™¨ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œè¯¥çº¿ç¨‹å°±è¿›å…¥åŒæ­¥çŠ¶æ€ï¼Œçº¿ç¨‹çŠ¶æ€å˜ä¸º BLOCKEDï¼Œå½“ Object çš„ç›‘è§†å™¨å æœ‰è€…é‡Šæ”¾åï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­å¾—çº¿ç¨‹å°±ä¼šæœ‰æœºä¼šé‡æ–°è·å–è¯¥ç›‘è§†å™¨ã€‚</p><h3 id="å¯é‡å…¥åŸç†-åŠ é”æ¬¡æ•°è®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#å¯é‡å…¥åŸç†-åŠ é”æ¬¡æ•°è®¡æ•°å™¨"><span>å¯é‡å…¥åŸç†ï¼šåŠ é”æ¬¡æ•°è®¡æ•°å™¨</span></a></h3><ul><li><strong>ä»€ä¹ˆæ˜¯å¯é‡å…¥ï¼Ÿå¯é‡å…¥é”</strong>ï¼Ÿ</li></ul><p><strong>å¯é‡å…¥</strong>ï¼šï¼ˆæ¥æºäºç»´åŸºç™¾ç§‘ï¼‰è‹¥ä¸€ä¸ªç¨‹åºæˆ–å­ç¨‹åºå¯ä»¥â€œåœ¨ä»»æ„æ—¶åˆ»è¢«ä¸­æ–­ç„¶åæ“ä½œç³»ç»Ÿè°ƒåº¦æ‰§è¡Œå¦å¤–ä¸€æ®µä»£ç ï¼Œè¿™æ®µä»£ç åˆè°ƒç”¨äº†è¯¥å­ç¨‹åºä¸ä¼šå‡ºé”™â€ï¼Œåˆ™ç§°å…¶ä¸ºå¯é‡å…¥ï¼ˆreentrant æˆ–re-entrantï¼‰çš„ã€‚å³å½“è¯¥å­ç¨‹åºæ­£åœ¨è¿è¡Œæ—¶ï¼Œæ‰§è¡Œçº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥å¹¶æ‰§è¡Œå®ƒï¼Œä»ç„¶è·å¾—ç¬¦åˆè®¾è®¡æ—¶é¢„æœŸçš„ç»“æœã€‚ä¸å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹å®‰å…¨ä¸åŒï¼Œå¯é‡å…¥å¼ºè°ƒå¯¹å•ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é‡æ–°è¿›å…¥åŒä¸€ä¸ªå­ç¨‹åºä»ç„¶æ˜¯å®‰å…¨çš„ã€‚</p><p><strong>å¯é‡å…¥é”</strong>ï¼šåˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€… classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚</p><ul><li><strong>çœ‹å¦‚ä¸‹çš„ä¾‹å­</strong></li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> synchronizedDemo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        synchronizedDemo demo </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> synchronizedDemo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        demo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">method1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;: method1()&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        method2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;: method2()&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        method3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> method3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Thread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">currentThread</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;: method3()&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»“åˆå‰æ–‡ä¸­åŠ é”å’Œé‡Šæ”¾é”çš„åŸç†ï¼Œä¸éš¾ç†è§£ï¼š</p><ul><li>æ‰§è¡Œ monitorenter è·å–é” <ul><li>ï¼ˆmonitor è®¡æ•°å™¨=0ï¼Œå¯è·å–é”ï¼‰</li><li>æ‰§è¡Œ method1() æ–¹æ³•ï¼Œmonitor è®¡æ•°å™¨+1 -&gt; 1 ï¼ˆè·å–åˆ°é”ï¼‰</li><li>æ‰§è¡Œ method2() æ–¹æ³•ï¼Œmonitor è®¡æ•°å™¨+1 -&gt; 2</li><li>æ‰§è¡Œ method3() æ–¹æ³•ï¼Œmonitor è®¡æ•°å™¨+1 -&gt; 3</li></ul></li><li>æ‰§è¡Œmonitorexitå‘½ä»¤ <ul><li>method3() æ–¹æ³•æ‰§è¡Œå®Œï¼Œmonitor è®¡æ•°å™¨-1 -&gt; 2</li><li>method2() æ–¹æ³•æ‰§è¡Œå®Œï¼Œmonitor è®¡æ•°å™¨-1 -&gt; 1</li><li>method2() æ–¹æ³•æ‰§è¡Œå®Œï¼Œmonitor è®¡æ•°å™¨-1 -&gt; 0 ï¼ˆé‡Šæ”¾äº†é”ï¼‰</li><li>ï¼ˆmonitor è®¡æ•°å™¨=0ï¼Œé”è¢«é‡Šæ”¾äº†ï¼‰</li></ul></li></ul><p>è¿™å°±æ˜¯ synchronized çš„é‡å…¥æ€§ï¼Œå³åœ¨<strong>åŒä¸€é”ç¨‹</strong>ä¸­ï¼Œæ¯ä¸ªå¯¹è±¡æ‹¥æœ‰ä¸€ä¸ªmonitorè®¡æ•°å™¨ï¼Œå½“çº¿ç¨‹è·å–è¯¥å¯¹è±¡é”åï¼Œmonitorè®¡æ•°å™¨å°±ä¼šåŠ ä¸€ï¼Œé‡Šæ”¾é”åå°±ä¼šå°†monitorè®¡æ•°å™¨å‡ä¸€ï¼Œçº¿ç¨‹ä¸éœ€è¦å†æ¬¡è·å–åŒä¸€æŠŠé”ã€‚</p><h3 id="ä¿è¯å¯è§æ€§çš„åŸç†-å†…å­˜æ¨¡å‹å’Œ-happens-before-è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#ä¿è¯å¯è§æ€§çš„åŸç†-å†…å­˜æ¨¡å‹å’Œ-happens-before-è§„åˆ™"><span>ä¿è¯å¯è§æ€§çš„åŸç†ï¼šå†…å­˜æ¨¡å‹å’Œ happens-before è§„åˆ™</span></a></h3><p>synchronized çš„ happens-before è§„åˆ™ï¼Œå³ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹åŒä¸€ä¸ªç›‘è§†å™¨çš„è§£é”ï¼Œhappens-before äºå¯¹è¯¥ç›‘è§†å™¨çš„åŠ é”ã€‚ç»§ç»­æ¥çœ‹ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> MonitorDemo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> writer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {     </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">        a</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;                                </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                                       // 3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> synchronized</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> reader</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {    </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> i</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a;                         </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">                                      // 6</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥ä»£ç çš„ happens-before å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-3-DUSM71XK.png" alt=""></p><p>åœ¨å›¾ä¸­æ¯ä¸€ä¸ªç®­å¤´è¿æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹å°±ä»£è¡¨ä¹‹é—´çš„ happens-before å…³ç³»ï¼Œé»‘è‰²çš„æ˜¯é€šè¿‡ç¨‹åºé¡ºåºè§„åˆ™æ¨å¯¼å‡ºæ¥ï¼Œçº¢è‰²çš„ä¸ºç›‘è§†å™¨é”è§„åˆ™æ¨å¯¼è€Œå‡ºï¼šçº¿ç¨‹ A é‡Šæ”¾é” happens-before çº¿ç¨‹ B åŠ é”ï¼Œè“è‰²çš„åˆ™æ˜¯é€šè¿‡ç¨‹åºé¡ºåºè§„åˆ™å’Œç›‘è§†å™¨é”è§„åˆ™æ¨æµ‹å‡ºæ¥ happens-befor å…³ç³»ï¼Œé€šè¿‡ä¼ é€’æ€§è§„åˆ™è¿›ä¸€æ­¥æ¨å¯¼çš„ happens-before å…³ç³»ã€‚ç°åœ¨æˆ‘ä»¬æ¥é‡ç‚¹å…³æ³¨2 happens-before 5ï¼Œé€šè¿‡è¿™ä¸ªå…³ç³»æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»€ä¹ˆ?</p><p>æ ¹æ® happens-before çš„å®šä¹‰ä¸­çš„ä¸€æ¡:å¦‚æœ A happens-before Bï¼Œåˆ™ A çš„æ‰§è¡Œç»“æœå¯¹ B å¯è§ï¼Œå¹¶ä¸” A çš„æ‰§è¡Œé¡ºåºå…ˆäº Bã€‚çº¿ç¨‹ A å…ˆå¯¹å…±äº«å˜é‡Aè¿›è¡ŒåŠ ä¸€ï¼Œç”±2 happens-before 5å…³ç³»å¯çŸ¥çº¿ç¨‹ A çš„æ‰§è¡Œç»“æœå¯¹çº¿ç¨‹ B å¯è§å³çº¿ç¨‹Bæ‰€è¯»å–åˆ°çš„ a çš„å€¼ä¸º1ã€‚</p><h2 id="jvm-ä¸­é”çš„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#jvm-ä¸­é”çš„ä¼˜åŒ–"><span>JVM ä¸­é”çš„ä¼˜åŒ–</span></a></h2><p>ç®€å•æ¥è¯´åœ¨ JVM ä¸­ monitorenter å’Œ monitorexit å­—èŠ‚ç ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ <code>Mutex Lock</code> æ¥å®ç°çš„ï¼Œä½†æ˜¯ç”±äºä½¿ç”¨ Mutex Lock éœ€è¦å°†å½“å‰çº¿ç¨‹æŒ‚èµ·å¹¶ä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€æ¥æ‰§è¡Œï¼Œè¿™ç§åˆ‡æ¢çš„ä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ï¼›ç„¶è€Œåœ¨ç°å®ä¸­çš„å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒåŒæ­¥æ–¹æ³•æ˜¯è¿è¡Œåœ¨å•çº¿ç¨‹ç¯å¢ƒ(æ— é”ç«äº‰ç¯å¢ƒ)å¦‚æœæ¯æ¬¡éƒ½è°ƒç”¨ Mutex Lock é‚£ä¹ˆå°†ä¸¥é‡çš„å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚</p><p><strong>æ³¨ï¼šä¸è¿‡åœ¨ JDK 1.6 ä¸­å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚é”ç²—åŒ–(Lock Coarsening)ã€é”æ¶ˆé™¤(Lock Elimination)ã€è½»é‡çº§é”(Lightweight Locking)ã€åå‘é”(Biased Locking)ã€é€‚åº”æ€§è‡ªæ—‹(Adaptive Spinning)ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€</strong>ã€‚</p><ul><li><p><strong><code>é”ç²—åŒ–(Lock Coarsening)</code></strong>ï¼šä¹Ÿå°±æ˜¯å‡å°‘ä¸å¿…è¦çš„ç´§è¿åœ¨ä¸€èµ·çš„ unlockï¼Œlock æ“ä½œï¼Œå°†å¤šä¸ªè¿ç»­çš„é”æ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚</p></li><li><p><strong><code>é”æ¶ˆé™¤(Lock Elimination)</code></strong>ï¼šé€šè¿‡è¿è¡Œæ—¶JITç¼–è¯‘å™¨çš„é€ƒé€¸åˆ†ææ¥æ¶ˆé™¤ä¸€äº›æ²¡æœ‰åœ¨å½“å‰åŒæ­¥å—ä»¥å¤–è¢«å…¶ä»–çº¿ç¨‹å…±äº«çš„æ•°æ®çš„é”ä¿æŠ¤ï¼Œé€šè¿‡é€ƒé€¸åˆ†æä¹Ÿå¯ä»¥åœ¨çº¿ç¨‹æœ¬çš„ Stack ä¸Šè¿›è¡Œå¯¹è±¡ç©ºé—´çš„åˆ†é…(åŒæ—¶è¿˜å¯ä»¥å‡å°‘ Heap ä¸Šçš„åƒåœ¾æ”¶é›†å¼€é”€)ã€‚</p></li><li><p><strong><code>è½»é‡çº§é”(Lightweight Locking)</code></strong>ï¼šè¿™ç§é”å®ç°çš„èƒŒååŸºäºè¿™æ ·ä¸€ç§å‡è®¾ï¼Œå³åœ¨çœŸå®çš„æƒ…å†µä¸‹æˆ‘ä»¬ç¨‹åºä¸­çš„å¤§éƒ¨åˆ†åŒæ­¥ä»£ç ä¸€èˆ¬éƒ½å¤„äºæ— é”ç«äº‰çŠ¶æ€(å³å•çº¿ç¨‹æ‰§è¡Œç¯å¢ƒ)ï¼Œåœ¨æ— é”ç«äº‰çš„æƒ…å†µä¸‹å®Œå…¨å¯ä»¥é¿å…è°ƒç”¨æ“ä½œç³»ç»Ÿå±‚é¢çš„é‡é‡çº§äº’æ–¥é”ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯åœ¨ monitorenter å’Œ monitorexit ä¸­åªéœ€è¦ä¾é ä¸€æ¡ CAS åŸå­æŒ‡ä»¤å°±å¯ä»¥å®Œæˆé”çš„è·å–åŠé‡Šæ”¾ã€‚å½“å­˜åœ¨é”ç«äº‰çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œ CAS æŒ‡ä»¤å¤±è´¥çš„çº¿ç¨‹å°†è°ƒç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é”è¿›å…¥åˆ°é˜»å¡çŠ¶æ€ï¼Œå½“é”è¢«é‡Šæ”¾çš„æ—¶å€™è¢«å”¤é†’(å…·ä½“å¤„ç†æ­¥éª¤ä¸‹é¢è¯¦ç»†è®¨è®º)ã€‚</p></li><li><p><strong><code>åå‘é”(Biased Locking)</code></strong>ï¼šæ˜¯ä¸ºäº†åœ¨æ— é”ç«äº‰çš„æƒ…å†µä¸‹é¿å…åœ¨é”è·å–è¿‡ç¨‹ä¸­æ‰§è¡Œä¸å¿…è¦çš„CASåŸå­æŒ‡ä»¤ï¼Œå› ä¸º CAS åŸå­æŒ‡ä»¤è™½ç„¶ç›¸å¯¹äºé‡é‡çº§é”æ¥è¯´å¼€é”€æ¯”è¾ƒå°ä½†è¿˜æ˜¯å­˜åœ¨éå¸¸å¯è§‚çš„æœ¬åœ°å»¶è¿Ÿã€‚</p></li><li><p><strong><code>é€‚åº”æ€§è‡ªæ—‹(Adaptive Spinning)</code></strong>ï¼šå½“çº¿ç¨‹åœ¨è·å–è½»é‡çº§é”çš„è¿‡ç¨‹ä¸­æ‰§è¡ŒCASæ“ä½œå¤±è´¥æ—¶ï¼Œåœ¨è¿›å…¥ä¸monitorç›¸å…³è”çš„æ“ä½œç³»ç»Ÿé‡é‡çº§é”(mutex semaphore)å‰ä¼šè¿›å…¥å¿™ç­‰å¾…(Spinning)ç„¶åå†æ¬¡å°è¯•ï¼Œå½“å°è¯•ä¸€å®šçš„æ¬¡æ•°åå¦‚æœä»ç„¶æ²¡æœ‰æˆåŠŸåˆ™è°ƒç”¨ä¸è¯¥monitorå…³è”çš„semaphore(å³äº’æ–¥é”)è¿›å…¥åˆ°é˜»å¡çŠ¶æ€ã€‚</p></li></ul><blockquote><p>ä¸‹é¢æ¥è¯¦ç»†è®²è§£ä¸‹ï¼Œå…ˆä» synchronied åŒæ­¥é”å¼€å§‹è®²èµ·ï¼š</p></blockquote><h3 id="é”çš„ç±»å‹" tabindex="-1"><a class="header-anchor" href="#é”çš„ç±»å‹"><span>é”çš„ç±»å‹</span></a></h3><p>åœ¨ Java SE 1.6 é‡Œ synchronied åŒæ­¥é”ï¼Œä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼š<code>æ— é”</code>ã€<code>åå‘é”</code>ã€<code>è½»é‡çº§é”</code>ã€<code>é‡é‡çº§é”</code>ï¼Œå®ƒä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†æ˜¯ä¸å¯ä»¥é™çº§ï¼Œç›®çš„æ˜¯ä¸ºäº†æä¾›è·å–é”å’Œé‡Šæ”¾é”çš„æ•ˆç‡ã€‚</p><blockquote><p>é”è†¨èƒ€æ–¹å‘ï¼š æ— é” â†’ åå‘é” â†’ è½»é‡çº§é” â†’ é‡é‡çº§é” (æ­¤è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„)</p></blockquote><h3 id="è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”" tabindex="-1"><a class="header-anchor" href="#è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”"><span>è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”</span></a></h3><h4 id="è‡ªæ—‹é”" tabindex="-1"><a class="header-anchor" href="#è‡ªæ—‹é”"><span>è‡ªæ—‹é”</span></a></h4><blockquote><p>å¼•å…¥èƒŒæ™¯ï¼šå¤§å®¶éƒ½çŸ¥é“ï¼Œåœ¨æ²¡æœ‰åŠ å…¥é”ä¼˜åŒ–æ—¶ï¼Œsynchronized æ˜¯ä¸€ä¸ªéå¸¸â€œèƒ–å¤§â€çš„å®¶ä¼™ã€‚åœ¨å¤šçº¿ç¨‹ç«äº‰é”æ—¶ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–é”æ—¶ï¼Œå®ƒä¼šé˜»å¡æ‰€æœ‰æ­£åœ¨ç«äº‰çš„çº¿ç¨‹ï¼Œè¿™æ ·å¯¹æ€§èƒ½å¸¦æ¥äº†æå¤§çš„å½±å“ã€‚åœ¨æŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹çš„æ“ä½œéƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€ä¸­å®Œæˆï¼Œè¿™äº›æ“ä½œå¯¹ç³»ç»Ÿçš„å¹¶å‘æ€§èƒ½å¸¦æ¥äº†å¾ˆå¤§çš„å‹åŠ›ã€‚åŒæ—¶ HotSpot å›¢é˜Ÿæ³¨æ„åˆ°åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå…±äº«æ•°æ®çš„é”å®šçŠ¶æ€åªä¼šæŒç»­å¾ˆçŸ­çš„ä¸€æ®µæ—¶é—´ï¼Œä¸ºäº†è¿™æ®µæ—¶é—´å»æŒ‚èµ·å’Œå›å¤é˜»å¡çº¿ç¨‹å¹¶ä¸å€¼å¾—ã€‚åœ¨å¦‚ä»Šå¤šå¤„ç†å™¨ç¯å¢ƒä¸‹ï¼Œå®Œå…¨å¯ä»¥è®©å¦ä¸€ä¸ªæ²¡æœ‰è·å–åˆ°é”çš„çº¿ç¨‹åœ¨é—¨å¤–ç­‰å¾…ä¸€ä¼š(è‡ªæ—‹)ï¼Œä½†ä¸æ”¾å¼ƒ CPU çš„æ‰§è¡Œæ—¶é—´ã€‚ç­‰å¾…æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ä¸ºäº†è®©çº¿ç¨‹ç­‰å¾…ï¼Œæˆ‘ä»¬åªéœ€è¦è®©çº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå¿™å¾ªç¯(è‡ªæ—‹)ï¼Œè¿™ä¾¿æ˜¯è‡ªæ—‹é”ç”±æ¥çš„åŸå› ã€‚</p></blockquote><p>â€‹è‡ªæ—‹é”æ—©åœ¨ JDK 1.4 ä¸­å°±å¼•å…¥äº†ï¼Œåªæ˜¯å½“æ—¶é»˜è®¤æ—¶å…³é—­çš„ã€‚åœ¨ JDK 1.6 åé»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ã€‚è‡ªæ—‹é”æœ¬è´¨ä¸Šä¸é˜»å¡å¹¶ä¸ç›¸åŒï¼Œå…ˆä¸è€ƒè™‘å…¶å¯¹å¤šå¤„ç†å™¨çš„è¦æ±‚ï¼Œå¦‚æœé”å ç”¨çš„æ—¶é—´éå¸¸çš„çŸ­ï¼Œé‚£ä¹ˆè‡ªæ—‹é”çš„æ€§èƒ½ä¼šéå¸¸çš„å¥½ï¼Œç›¸åï¼Œå…¶ä¼šå¸¦æ¥æ›´å¤šçš„æ€§èƒ½å¼€é”€(å› ä¸ºåœ¨çº¿ç¨‹è‡ªæ—‹æ—¶ï¼Œå§‹ç»ˆä¼šå ç”¨ CPU çš„æ—¶é—´ç‰‡ï¼Œå¦‚æœé”å ç”¨çš„æ—¶é—´å¤ªé•¿ï¼Œé‚£ä¹ˆè‡ªæ—‹çš„çº¿ç¨‹ä¼šç™½ç™½æ¶ˆè€—æ‰ CPU èµ„æº)ã€‚å› æ­¤è‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šçš„æ¬¡æ•°ä»ç„¶æ²¡æœ‰æˆåŠŸè·å–åˆ°é”ï¼Œå°±åº”è¯¥ä½¿ç”¨ä¼ ç»Ÿçš„æ–¹å¼å»æŒ‚èµ·çº¿ç¨‹äº†ï¼Œåœ¨ JDK å®šä¹‰ä¸­ï¼Œè‡ªæ—‹é”é»˜è®¤çš„è‡ªæ—‹æ¬¡æ•°ä¸º <code>10</code> æ¬¡ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å‚æ•°<code>-XX:PreBlockSpin</code>æ¥æ›´æ”¹ã€‚</p><p>å¯æ˜¯ç°åœ¨åˆå‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœçº¿ç¨‹é”åœ¨çº¿ç¨‹è‡ªæ—‹åˆšç»“æŸå°±é‡Šæ”¾æ‰äº†é”ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯æœ‰ç‚¹å¾—ä¸å¿å¤±ã€‚æ‰€ä»¥è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦æ›´åŠ èªæ˜çš„é”æ¥å®ç°æ›´åŠ çµæ´»çš„è‡ªæ—‹ã€‚æ¥æé«˜å¹¶å‘çš„æ€§èƒ½ã€‚(è¿™é‡Œåˆ™éœ€è¦è‡ªé€‚åº”è‡ªæ—‹é”ï¼)</p><h4 id="è‡ªé€‚åº”è‡ªæ—‹é”" tabindex="-1"><a class="header-anchor" href="#è‡ªé€‚åº”è‡ªæ—‹é”"><span>è‡ªé€‚åº”è‡ªæ—‹é”</span></a></h4><p>â€‹ åœ¨ JDK 1.6 ä¸­å¼•å…¥äº†è‡ªé€‚åº”è‡ªæ—‹é”ã€‚è¿™å°±æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸å†å›ºå®šäº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹ æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šçš„ã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å–è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆ JVM ä¼šè®¤ä¸ºè¯¥é”è‡ªæ—‹è·å–åˆ°é”çš„å¯èƒ½æ€§å¾ˆå¤§ï¼Œä¼šè‡ªåŠ¨å¢åŠ ç­‰å¾…æ—¶é—´ã€‚æ¯”å¦‚å¢åŠ åˆ° <code>100</code> æ­¤å¾ªç¯ã€‚ç›¸åï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å–é”ã€‚é‚£å†ä»¥åè¦è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥é¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚æœ‰äº†è‡ªé€‚åº”è‡ªæ—‹ï¼ŒJVM å¯¹ç¨‹åºçš„é”çš„çŠ¶æ€é¢„æµ‹ä¼šè¶Šæ¥è¶Šå‡†ç¡®ï¼ŒJVM ä¹Ÿä¼šè¶Šæ¥è¶Šèªæ˜ã€‚</p><h3 id="é”æ¶ˆé™¤" tabindex="-1"><a class="header-anchor" href="#é”æ¶ˆé™¤"><span>é”æ¶ˆé™¤</span></a></h3><p>é”æ¶ˆé™¤æ˜¯æŒ‡è™šæ‹Ÿæœºå³æ—¶ç¼–è¯‘å™¨å†è¿è¡Œæ—¶ï¼Œå¯¹ä¸€äº›ä»£ç ä¸Šè¦æ±‚åŒæ­¥ï¼Œä½†æ˜¯è¢«æ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰çš„é”è¿›è¡Œæ¶ˆé™¤ã€‚é”æ¶ˆé™¤çš„ä¸»è¦åˆ¤å®šä¾æ®æ¥æºäºé€ƒé€¸åˆ†æçš„æ•°æ®æ”¯æŒã€‚æ„æ€å°±æ˜¯ï¼šJVM ä¼šåˆ¤æ–­å†ä¸€æ®µç¨‹åºä¸­çš„åŒæ­¥æ˜æ˜¾ä¸ä¼šé€ƒé€¸å‡ºå»ä»è€Œè¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œé‚£ JVM å°±æŠŠå®ƒä»¬å½“ä½œæ ˆä¸Šæ•°æ®å¯¹å¾…ï¼Œè®¤ä¸ºè¿™äº›æ•°æ®æ˜¯çº¿ç¨‹ç‹¬æœ‰çš„ï¼Œä¸éœ€è¦åŠ åŒæ­¥ã€‚æ­¤æ—¶å°±ä¼šè¿›è¡Œé”æ¶ˆé™¤ã€‚</p><p>â€‹å½“ç„¶åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆæ¸…æ¥šçš„çŸ¥é“å“ªäº›æ˜¯çº¿ç¨‹ç‹¬æœ‰çš„ï¼Œä¸éœ€è¦åŠ åŒæ­¥é”ï¼Œä½†æ˜¯åœ¨ Java API ä¸­æœ‰å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯åŠ äº†åŒæ­¥çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶ JVM ä¼šåˆ¤æ–­è¿™æ®µä»£ç æ˜¯å¦éœ€è¦åŠ é”ã€‚å¦‚æœæ•°æ®å¹¶ä¸ä¼šé€ƒé€¸ï¼Œåˆ™ä¼šè¿›è¡Œé”æ¶ˆé™¤ã€‚æ¯”å¦‚å¦‚ä¸‹æ“ä½œï¼šåœ¨æ“ä½œ String ç±»å‹æ•°æ®æ—¶ï¼Œç”±äº String æ˜¯ä¸€ä¸ªä¸å¯å˜ç±»ï¼Œå¯¹å­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œæ€»æ˜¯é€šè¿‡ç”Ÿæˆçš„æ–°çš„ String å¯¹è±¡æ¥è¿›è¡Œçš„ã€‚å› æ­¤ Javac ç¼–è¯‘å™¨ä¼šå¯¹ String è¿æ¥åšè‡ªåŠ¨ä¼˜åŒ–ã€‚</p><ul><li>åœ¨ JDK 1.5 ä¹‹å‰ä¼šä½¿ç”¨ StringBuffer å¯¹è±¡çš„è¿ç»­ append() æ“ä½œ<code>ï¼ˆStringBuffer çš„æ–¹æ³•éƒ½æ˜¯åŠ äº† synchronized å…³é”®å­—çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰</code>ï¼›</li><li>åœ¨ JDK 1.5 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œä¼šè½¬åŒ–ä¸º StringBuidler å¯¹è±¡çš„è¿ç»­ append() æ“ä½œ<code>ï¼ˆStringBuffer çš„æ–¹æ³•æ²¡æœ‰åŠ  synchronized å…³é”®å­—çš„ï¼Œä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰</code>ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> test03</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s3) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä½¿ç”¨ javap ç¼–è¯‘ç»“æœ</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-4-DJnPyZt_.png" alt=""></p><p>è™½ç„¶ StringBuilder ä¸æ˜¯å®‰å…¨åŒæ­¥çš„ï¼Œä½†æ˜¯åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒJVM åˆ¤æ–­è¯¥æ®µä»£ç å¹¶ä¸ä¼šé€ƒé€¸ï¼Œåˆ™å°†è¯¥ä»£ç å¸¦é»˜è®¤ä¸ºçº¿ç¨‹ç‹¬æœ‰çš„èµ„æºï¼Œå¹¶ä¸éœ€è¦åŒæ­¥ï¼Œæ‰€ä»¥æ‰§è¡Œäº†é”æ¶ˆé™¤æ“ä½œã€‚(è¿˜æœ‰ Vector ä¸­çš„å„ç§æ“ä½œä¹Ÿå¯å®ç°é”æ¶ˆé™¤ã€‚åœ¨æ²¡æœ‰é€ƒé€¸å‡ºæ•°æ®å®‰å…¨é˜²å«å†…)</p><h3 id="é”ç²—åŒ–" tabindex="-1"><a class="header-anchor" href="#é”ç²—åŒ–"><span>é”ç²—åŒ–</span></a></h3><p>â€‹åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬éƒ½çŸ¥é“åœ¨åŠ åŒæ­¥é”æ—¶ï¼Œå°½å¯èƒ½çš„å°†åŒæ­¥å—çš„ä½œç”¨èŒƒå›´é™åˆ¶åˆ°å°½é‡å°çš„èŒƒå›´(åªåœ¨å…±äº«æ•°æ®çš„å®é™…ä½œç”¨åŸŸä¸­æ‰è¿›è¡ŒåŒæ­¥ï¼Œè¿™æ ·æ˜¯ä¸ºäº†ä½¿å¾—éœ€è¦åŒæ­¥çš„æ“ä½œæ•°é‡å°½å¯èƒ½å˜å°ã€‚åœ¨å­˜åœ¨é”åŒæ­¥ç«äº‰ä¸­ï¼Œä¹Ÿå¯ä»¥ä½¿å¾—ç­‰å¾…é”çš„çº¿ç¨‹å°½æ—©çš„æ‹¿åˆ°é”)ã€‚</p><p>â€‹å¤§éƒ¨åˆ†ä¸Šè¿°æƒ…å†µæ˜¯å®Œç¾æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æœå­˜åœ¨è¿ä¸²çš„ä¸€ç³»åˆ—æ“ä½œéƒ½å¯¹åŒä¸€ä¸ªå¯¹è±¡åå¤åŠ é”å’Œè§£é”ï¼Œç”šè‡³åŠ é”æ“ä½œæ—¶å‡ºç°åœ¨å¾ªç¯ä½“ä¸­çš„ï¼Œé‚£å³ä½¿æ²¡æœ‰çº¿ç¨‹ç«äº‰ï¼Œé¢‘ç¹çš„è¿›è¡Œäº’æ–¥åŒæ­¥æ“ä½œä¹Ÿä¼šå¯¼è‡´ä¸å¿…è¦çš„æ€§èƒ½æ“ä½œã€‚</p><p>è¿™é‡Œè´´ä¸Šæ ¹æ®ä¸Šè¿° Javap ç¼–è¯‘çš„æƒ…å†µç¼–å†™çš„å®ä¾‹ java ç±»</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> test04</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> s3) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    StringBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sb </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> StringBuffer</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    sb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(s1);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    sb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(s2);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    sb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">append</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(s3);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> sb</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>â€‹åœ¨ä¸Šè¿°çš„è¿ç»­ append() æ“ä½œä¸­å°±å±äºè¿™ç±»æƒ…å†µã€‚JVM ä¼šæ£€æµ‹åˆ°è¿™æ ·ä¸€è¿ä¸²çš„æ“ä½œéƒ½æ˜¯å¯¹åŒä¸€ä¸ªå¯¹è±¡åŠ é”ï¼Œé‚£ä¹ˆ JVM ä¼šå°†åŠ é”åŒæ­¥çš„èŒƒå›´æ‰©å±•(ç²—åŒ–)åˆ°æ•´ä¸ªä¸€ç³»åˆ—æ“ä½œçš„å¤–éƒ¨ï¼Œä½¿æ•´ä¸ªä¸€è¿ä¸²çš„ append() æ“ä½œåªéœ€è¦åŠ é”ä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p><h3 id="è½»é‡çº§é”" tabindex="-1"><a class="header-anchor" href="#è½»é‡çº§é”"><span>è½»é‡çº§é”</span></a></h3><p>â€‹åœ¨ JDK 1.6 ä¹‹åå¼•å…¥çš„è½»é‡çº§é”ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è½»é‡çº§é”å¹¶ä¸æ˜¯æ›¿ä»£é‡é‡çº§é”çš„ï¼Œè€Œæ˜¯å¯¹åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹åŒæ­¥å—å¹¶ä¸ä¼šæœ‰ç«äº‰å‡ºç°æå‡ºçš„ä¸€ç§ä¼˜åŒ–ã€‚å®ƒå¯ä»¥å‡å°‘é‡é‡çº§é”å¯¹çº¿ç¨‹çš„é˜»å¡å¸¦æ¥çš„çº¿ç¨‹å¼€é”€ã€‚ä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</p><p>â€‹å¦‚æœè¦ç†è§£è½»é‡çº§é”ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆè¦äº†è§£ HotSpot è™šæ‹Ÿæœºä¸­å¯¹è±¡å¤´çš„å†…å­˜å¸ƒå±€ã€‚ä¸Šé¢ä»‹ç» Java å¯¹è±¡å¤´ä¹Ÿè¯¦ç»†ä»‹ç»è¿‡ã€‚åœ¨å¯¹è±¡å¤´ä¸­(<code>Object Header</code>)å­˜åœ¨ä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œ<code>HashCode</code>ã€<code>GC Age</code>ã€<code>é”æ ‡è®°ä½</code>ã€<code>æ˜¯å¦ä¸ºåå‘é”</code>ã€‚ç­‰ã€‚ä¸€èˆ¬ä¸º 32 ä½æˆ–è€… 64 ä½(è§†æ“ä½œç³»ç»Ÿä½æ•°å®š)ã€‚å®˜æ–¹ç§°ä¹‹ä¸º<code>Mark Word</code>ï¼Œå®ƒæ˜¯å®ç°è½»é‡çº§é”å’Œåå‘é”çš„å…³é”®ã€‚ å¦å¤–ä¸€éƒ¨åˆ†å­˜å‚¨çš„æ˜¯æŒ‡å‘æ–¹æ³•åŒºå¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆ(<code>Klass Point</code>)ï¼Œå¦‚æœå¯¹è±¡æ˜¯æ•°ç»„çš„è¯ï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„éƒ¨åˆ†ç”¨äºå­˜å‚¨æ•°æ®çš„é•¿åº¦ã€‚</p><h4 id="è½»é‡çº§é”åŠ é”" tabindex="-1"><a class="header-anchor" href="#è½»é‡çº§é”åŠ é”"><span>è½»é‡çº§é”åŠ é”</span></a></h4><p>åœ¨çº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—ä¹‹å‰ï¼ŒJVM ä¼šå…ˆåœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºé”è®°å½•(<code>Lock Record</code>)çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„<code>Mark Word</code>çš„æ‹·è´(JVMä¼šå°†å¯¹è±¡å¤´ä¸­çš„<code>Mark Word</code>æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå®˜æ–¹ç§°ä¸º<code>Displaced Mark Ward</code>)è¿™ä¸ªæ—¶å€™çº¿ç¨‹å †æ ˆä¸å¯¹è±¡å¤´çš„çŠ¶æ€å¦‚å›¾ï¼š</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-5-CrLjxvwW.png" alt=""></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼šå¦‚æœå½“å‰å¯¹è±¡æ²¡æœ‰è¢«é”å®šï¼Œé‚£ä¹ˆé”æ ‡å¿—ä½ä¸º 01 çŠ¶æ€ï¼ŒJVM åœ¨æ‰§è¡Œå½“å‰çº¿ç¨‹æ—¶ï¼Œé¦–å…ˆä¼šåœ¨å½“å‰çº¿ç¨‹æ ˆå¸§ä¸­åˆ›å»ºé”è®°å½•<code>Lock Record</code>çš„ç©ºé—´ç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„<code>Mark Word</code>çš„æ‹·è´ã€‚</p><p>â€‹ç„¶åï¼Œè™šæ‹Ÿæœºä½¿ç”¨CASæ“ä½œå°†æ ‡è®°å­—æ®µ <code>Mark Word</code> æ‹·è´åˆ°é”è®°å½•ä¸­ï¼Œå¹¶ä¸”å°†<code>Mark Word</code>æ›´æ–°ä¸ºæŒ‡å‘<code>Lock Record</code>çš„æŒ‡é’ˆã€‚å¦‚æœæ›´æ–°æˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥ç”¨äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡ <code>Mark Word</code> çš„é”æ ‡å¿—ä½æ›´æ–°ä¸º(<code>Mark Word</code>ä¸­æœ€åçš„ 2bit)00ï¼Œå³è¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ï¼Œå¦‚å›¾ï¼š</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-6-Dk2f09-A.png" alt=""></p><p>â€‹å¦‚æœè¿™ä¸ªæ›´æ–°æ“ä½œå¤±è´¥ï¼ŒJVM ä¼šæ£€æŸ¥å½“å‰çš„<code>Mark Word</code>ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§çš„æŒ‡é’ˆï¼Œå¦‚æœæœ‰ï¼Œè¯´æ˜è¯¥é”å·²ç»è¢«è·å–ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¯´æ˜è¯¥é”è¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†ï¼Œå¦‚æœæœ‰ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹ç«äº‰åŒä¸€ä¸ªé”ï¼Œé‚£è½»é‡çº§é”å°±ä¸å†æœ‰æ•ˆï¼Œç›´æ¥è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚æ­¤æ—¶ï¼Œé”çš„æ ‡å¿—ä½ä¸º<code>10.Mark Word</code>ä¸­å­˜å‚¨çš„æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆã€‚</p><p>â€‹è½»é‡çº§è§£é”æ—¶ï¼Œä¼šä½¿ç”¨åŸå­çš„CASæ“ä½œå°†<code>Displaced Mark Word</code>æ›¿æ¢å›åˆ°å¯¹è±¡å¤´ä¸­ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰å‘ç”Ÿç«äº‰å…³ç³»ã€‚å¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºå½“å‰é”å­˜åœ¨ç«äº‰å…³ç³»ã€‚é”å°±ä¼šè†¨èƒ€æˆé‡é‡çº§é”ã€‚ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶äº‰å¤ºé”ï¼Œå¯¼è‡´é”è†¨èƒ€çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-7-DRGLWU-A.png" alt=""></p><h3 id="åå‘é”" tabindex="-1"><a class="header-anchor" href="#åå‘é”"><span>åå‘é”</span></a></h3><blockquote><p>å¼•å…¥èƒŒæ™¯ï¼šåœ¨å¤§å¤šå®é™…ç¯å¢ƒä¸‹ï¼Œé”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–ï¼Œé‚£ä¹ˆåœ¨åŒä¸€ä¸ªçº¿ç¨‹åå¤è·å–æ‰€é‡Šæ”¾é”ä¸­ï¼Œå…¶ä¸­å¹¶è¿˜æ²¡æœ‰é”çš„ç«äº‰ï¼Œé‚£ä¹ˆè¿™æ ·çœ‹ä¸Šå»ï¼Œå¤šæ¬¡çš„è·å–é”å’Œé‡Šæ”¾é”å¸¦æ¥äº†å¾ˆå¤šä¸å¿…è¦çš„æ€§èƒ½å¼€é”€å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p></blockquote><p>â€‹ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼ŒHotSpot çš„ä½œè€…åœ¨ Java SE 1.6 ä¸­å¯¹ synchronized è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†åå‘é”ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨å¯¹è±¡å¤´å’Œæ ˆå¸§ä¸­çš„é”è®°å½•é‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹ IDï¼Œä»¥åè¯¥çº¿ç¨‹åœ¨è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸éœ€è¦è¿›è¡Œ CAS æ“ä½œæ¥åŠ é”å’Œè§£é”ã€‚åªéœ€è¦ç®€å•çš„æµ‹è¯•ä¸€ä¸‹å¯¹è±¡å¤´çš„<code>Mark Word</code>é‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¦‚æœæˆåŠŸï¼Œè¡¨ç¤ºçº¿ç¨‹å·²ç»è·å–åˆ°äº†é”ã€‚</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-8-BNnLwH8E.png" alt=""></p><h4 id="åå‘é”çš„æ’¤é”€" tabindex="-1"><a class="header-anchor" href="#åå‘é”çš„æ’¤é”€"><span>åå‘é”çš„æ’¤é”€</span></a></h4><p>â€‹åå‘é”ä½¿ç”¨äº†ä¸€ç§ç­‰å¾…ç«äº‰å‡ºç°æ‰ä¼šé‡Šæ”¾é”çš„æœºåˆ¶ã€‚æ‰€ä»¥å½“å…¶ä»–çº¿ç¨‹å°è¯•è·å–åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ã€‚ä½†æ˜¯åå‘é”çš„æ’¤é”€éœ€è¦ç­‰åˆ°å…¨å±€å®‰å…¨ç‚¹(å°±æ˜¯å½“å‰çº¿ç¨‹æ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç )ã€‚å®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œè®©ä½ åæ£€æŸ¥æŒæœ‰åå‘é”çš„çº¿ç¨‹æ˜¯å¦æ´»ç€ã€‚å¦‚æœçº¿ç¨‹ä¸å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œç›´æ¥å°†å¯¹è±¡å¤´è®¾ç½®ä¸ºæ— é”çŠ¶æ€ã€‚å¦‚æœçº¿ç¨‹æ´»ç€ï¼ŒJVM ä¼šéå†æ ˆå¸§ä¸­çš„é”è®°å½•ï¼Œæ ˆå¸§ä¸­çš„é”è®°å½•å’Œå¯¹è±¡å¤´è¦ä¹ˆåå‘äºå…¶ä»–çº¿ç¨‹ï¼Œè¦ä¹ˆæ¢å¤åˆ°æ— é”çŠ¶æ€æˆ–è€…æ ‡è®°å¯¹è±¡ä¸é€‚åˆä½œä¸ºåå‘é”ã€‚</p><p><img src="/leslie-blog/assets/java-thread-x-key-schronized-9-fKNznA7z.png" alt=""></p><h3 id="é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”"><span>é”çš„ä¼˜ç¼ºç‚¹å¯¹æ¯”</span></a></h3><table><thead><tr><th>é”</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åå‘é”</td><td>åŠ é”å’Œè§£é”ä¸éœ€è¦CASæ“ä½œï¼Œæ²¡æœ‰é¢å¤–çš„æ€§èƒ½æ¶ˆè€—ï¼Œå’Œæ‰§è¡ŒéåŒæ­¥æ–¹æ³•ç›¸æ¯”ä»…å­˜åœ¨çº³ç§’çº§çš„å·®è·</td><td>å¦‚æœçº¿ç¨‹é—´å­˜åœ¨é”ç«äº‰ï¼Œä¼šå¸¦æ¥é¢å¤–çš„é”æ’¤é”€çš„æ¶ˆè€—</td><td>é€‚ç”¨äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥å—çš„åœºæ™¯</td></tr><tr><td>è½»é‡çº§é”</td><td>ç«äº‰çš„çº¿ç¨‹ä¸ä¼šé˜»å¡ï¼Œæé«˜äº†å“åº”é€Ÿåº¦</td><td>å¦‚çº¿ç¨‹å§‹ç»ˆå¾—ä¸åˆ°é”ç«äº‰çš„çº¿ç¨‹ï¼Œä½¿ç”¨è‡ªæ—‹ä¼šæ¶ˆè€—CPUæ€§èƒ½</td><td>è¿½æ±‚å“åº”æ—¶é—´ï¼ŒåŒæ­¥å—æ‰§è¡Œé€Ÿåº¦éå¸¸å¿«</td></tr><tr><td>é‡é‡çº§é”</td><td>çº¿ç¨‹ç«äº‰ä¸é€‚ç”¨è‡ªæ—‹ï¼Œä¸ä¼šæ¶ˆè€—CPU</td><td>çº¿ç¨‹é˜»å¡ï¼Œå“åº”æ—¶é—´ç¼“æ…¢ï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œé¢‘ç¹çš„è·å–é‡Šæ”¾é”ï¼Œä¼šå¸¦æ¥å·¨å¤§çš„æ€§èƒ½æ¶ˆè€—</td><td>è¿½æ±‚ååé‡ï¼ŒåŒæ­¥å—æ‰§è¡Œé€Ÿåº¦è¾ƒé•¿</td></tr></tbody></table><h2 id="synchronized-ä¸-lock" tabindex="-1"><a class="header-anchor" href="#synchronized-ä¸-lock"><span>synchronized ä¸ Lock</span></a></h2><h3 id="synchronized-çš„ç¼ºé™·" tabindex="-1"><a class="header-anchor" href="#synchronized-çš„ç¼ºé™·"><span>synchronized çš„ç¼ºé™·</span></a></h3><ul><li><p><code>æ•ˆç‡ä½</code>ï¼šé”çš„é‡Šæ”¾æƒ…å†µå°‘ï¼Œåªæœ‰ä»£ç æ‰§è¡Œå®Œæ¯•æˆ–è€…å¼‚å¸¸ç»“æŸæ‰ä¼šé‡Šæ”¾é”ï¼›è¯•å›¾è·å–é”çš„æ—¶å€™ä¸èƒ½è®¾å®šè¶…æ—¶ï¼Œä¸èƒ½ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ä½¿ç”¨é”çš„çº¿ç¨‹ï¼Œç›¸å¯¹è€Œè¨€ï¼ŒLock å¯ä»¥ä¸­æ–­å’Œè®¾ç½®è¶…æ—¶</p></li><li><p><code>ä¸å¤Ÿçµæ´»</code>ï¼šåŠ é”å’Œé‡Šæ”¾çš„æ—¶æœºå•ä¸€ï¼Œæ¯ä¸ªé”ä»…æœ‰ä¸€ä¸ªå•ä¸€çš„æ¡ä»¶(æŸä¸ªå¯¹è±¡)ï¼Œç›¸å¯¹è€Œè¨€ï¼Œè¯»å†™é”æ›´åŠ çµæ´»</p></li><li><p><code>æ— æ³•çŸ¥é“æ˜¯å¦æˆåŠŸè·å¾—é”</code>ï¼Œç›¸å¯¹è€Œè¨€ï¼ŒLock å¯ä»¥æ‹¿åˆ°çŠ¶æ€ï¼Œå¦‚æœæˆåŠŸè·å–é”ï¼Œ....ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œ.....</p></li></ul><h3 id="lock-è§£å†³ç›¸åº”é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#lock-è§£å†³ç›¸åº”é—®é¢˜"><span>Lock è§£å†³ç›¸åº”é—®é¢˜</span></a></h3><p>Lock ç±»è¿™é‡Œä¸åšè¿‡å¤šè§£é‡Šï¼Œä¸»è¦çœ‹é‡Œé¢çš„4ä¸ªæ–¹æ³•:</p><ul><li><code>lock()</code>: åŠ é”</li><li><code>unlock()</code>: è§£é”</li><li><code>tryLock()</code>: å°è¯•è·å–é”ï¼Œè¿”å›ä¸€ä¸ªbooleanå€¼</li><li><code>tryLock(long,TimeUtil)</code>: å°è¯•è·å–é”ï¼Œå¯ä»¥è®¾ç½®è¶…æ—¶</li></ul><p>synchronized åŠ é”åªä¸ä¸€ä¸ªæ¡ä»¶(æ˜¯å¦è·å–é”)ç›¸å…³è”ï¼Œä¸çµæ´»ï¼Œåæ¥<code>Condition ä¸ Lock çš„ç»“åˆ</code>è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>å¤šçº¿ç¨‹ç«äº‰ä¸€ä¸ªé”æ—¶ï¼Œå…¶ä½™æœªå¾—åˆ°é”çš„çº¿ç¨‹åªèƒ½ä¸åœçš„å°è¯•è·å¾—é”ï¼Œè€Œä¸èƒ½ä¸­æ–­ã€‚é«˜å¹¶å‘çš„æƒ…å†µä¸‹ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ReentrantLock çš„ lockInterruptibly() æ–¹æ³•å¯ä»¥ä¼˜å…ˆè€ƒè™‘å“åº”ä¸­æ–­ã€‚ ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼Œå®ƒå¯ä»¥ä¸­æ–­è‡ªå·±ï¼Œç„¶å ReentrantLock å“åº”è¿™ä¸ªä¸­æ–­ï¼Œä¸å†è®©è¿™ä¸ªçº¿ç¨‹ç»§ç»­ç­‰å¾…ã€‚æœ‰äº†è¿™ä¸ªæœºåˆ¶ï¼Œä½¿ç”¨ ReentrantLock æ—¶å°±ä¸ä¼šåƒ synchronized é‚£æ ·äº§ç”Ÿæ­»é”äº†ã€‚</p><blockquote><p><code>ReentrantLock</code>ä¸ºå¸¸ç”¨ç±»ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é” Lockï¼Œå®ƒå…·æœ‰ä¸ä½¿ç”¨ synchronized æ–¹æ³•å’Œè¯­å¥æ‰€è®¿é—®çš„éšå¼ç›‘è§†å™¨é”ç›¸åŒçš„ä¸€äº›åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚è¯¦ç»†åˆ†æè¯·çœ‹: <a href="https://pdai.tech/md/java/thread/java-thread-x-lock-ReentrantLock.html" target="_blank" rel="noopener noreferrer">JUCé”: ReentrantLock è¯¦è§£</a></p></blockquote><h2 id="å†æ·±å…¥ç†è§£" tabindex="-1"><a class="header-anchor" href="#å†æ·±å…¥ç†è§£"><span>å†æ·±å…¥ç†è§£</span></a></h2><p>synchronized æ˜¯é€šè¿‡è½¯ä»¶(JVM)å®ç°çš„ï¼Œç®€å•æ˜“ç”¨ï¼Œå³ä½¿åœ¨ JDK5 ä¹‹åæœ‰äº† Lockï¼Œä»ç„¶è¢«å¹¿æ³›çš„ä½¿ç”¨ã€‚</p><ul><li><p><strong>ä½¿ç”¨ synchronized æœ‰å“ªäº›è¦æ³¨æ„çš„ï¼Ÿ</strong></p><ul><li>é”å¯¹è±¡ä¸èƒ½ä¸ºç©ºï¼Œå› ä¸ºé”çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¯¹è±¡å¤´é‡Œ</li><li>ä½œç”¨åŸŸä¸å®œè¿‡å¤§ï¼Œå½±å“ç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦ï¼Œæ§åˆ¶èŒƒå›´è¿‡å¤§ï¼Œç¼–å†™ä»£ç ä¹Ÿå®¹æ˜“å‡ºé”™</li><li>é¿å…æ­»é”</li><li>åœ¨èƒ½é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œæ—¢ä¸è¦ç”¨ Lock ä¹Ÿä¸è¦ç”¨ synchronized å…³é”®å­—ï¼Œç”¨ <code>java.util.concurrent</code> åŒ…ä¸­çš„å„ç§å„æ ·çš„ç±»ï¼Œå¦‚æœä¸ç”¨è¯¥åŒ…ä¸‹çš„ç±»ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—ï¼Œå› ä¸ºä»£ç é‡å°‘ï¼Œé¿å…å‡ºé”™</li></ul></li><li><p><strong>synchronized æ˜¯å…¬å¹³é”å—ï¼Ÿ</strong></p><p><code>ä¸æ˜¯</code>ã€‚synchronized æ˜¯éå…¬å¹³çš„ã€‚</p><p>éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚</p><p>ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚</p><p>éå…¬å¹³é”çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPU ä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚ç¼ºç‚¹æ˜¯å¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚</p></li></ul><h2 id="å‚è€ƒæ–‡ç« " tabindex="-1"><a class="header-anchor" href="#å‚è€ƒæ–‡ç« "><span>å‚è€ƒæ–‡ç« </span></a></h2><p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹+ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹</p><ul><li><a href="https://juejin.im/post/5ae6dc04f265da0ba351d3ff" target="_blank" rel="noopener noreferrer">https://juejin.im/post/5ae6dc04f265da0ba351d3ff</a></li><li><a href="https://www.cnblogs.com/javaminer/p/3889023.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/javaminer/p/3889023.html</a></li><li><a href="https://www.jianshu.com/p/dab7745c0954" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/dab7745c0954</a></li><li><a href="https://www.cnblogs.com/wuchaodzxx/p/6867546.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/wuchaodzxx/p/6867546.html</a></li><li><a href="https://www.cnblogs.com/xyabk/p/10901291.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/xyabk/p/10901291.html</a></li><li><a href="https://www.jianshu.com/p/64240319ed60" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/64240319ed60</a></li></ul></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: LeslieDYF@gmail.com">Leslie</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/leslie-blog/java/concurrency/volatile.html" aria-label="å…³é”®å­— volatile è¯¦è§£"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">å…³é”®å­— volatile è¯¦è§£<!----></div></a></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">é»˜è®¤é¡µè„š</div><div class="vp-copyright">Copyright Â© 2025 Evan </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/leslie-blog/assets/app-BJKu-9y2.js" defer></script>
  </body>
</html>
