import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as e,o as t,c as i,a as n,b as o,d as p,e as c}from"./app-D5nYSIv7.js";const l={},r=c(`<h1 id="vnc开机自动执行python脚本发送本机ip地址到指定邮箱" tabindex="-1"><a class="header-anchor" href="#vnc开机自动执行python脚本发送本机ip地址到指定邮箱"><span>VNC开机自动执行python脚本发送本机ip地址到指定邮箱</span></a></h1><h2 id="一、背景" tabindex="-1"><a class="header-anchor" href="#一、背景"><span>一、背景</span></a></h2><h3 id="问题" tabindex="-1"><a class="header-anchor" href="#问题"><span>问题：</span></a></h3><p>工作中主力机用MacBook，平常有些工具需要用Ubuntu（比如MTK装机软件）。<br> MacBook切换到Ubuntu主机的时候每次都需要将显示器从MacBook连接到Ubuntu主机上，比较麻烦。</p><h3 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法"><span>解决方法：</span></a></h3><p>Ubuntu每次开机都发送ip地址到指定邮箱，然后在MacBook上用vnc通过ip远程连接Ubuntu（Ubuntu主机接了个HDMI欺骗器，这样远程连接的时候才能显示桌面）</p><h2 id="二、脚本及开机自动执行" tabindex="-1"><a class="header-anchor" href="#二、脚本及开机自动执行"><span>二、脚本及开机自动执行</span></a></h2><h3 id="_1-安装ifconfig" tabindex="-1"><a class="header-anchor" href="#_1-安装ifconfig"><span>1. 安装ifconfig</span></a></h3><p>获取ip地址用到<code>ifconfig</code>这个命令，先在终端试一下有没有安装，没装的话先执行下面命令安装：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> net-tools
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-编写发送邮件脚本" tabindex="-1"><a class="header-anchor" href="#_2-编写发送邮件脚本"><span>2. 编写发送邮件脚本</span></a></h3><p>这里用python实现<code>send_email_when_power_on.py</code></p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python</span>
<span class="token comment"># -*- coding: UTF-8 -*-</span>

<span class="token keyword">import</span> os
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText
<span class="token keyword">import</span> smtplib
<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> Header
<span class="token keyword">import</span> time


<span class="token comment"># check network availability </span>
TIMEOUT<span class="token operator">=</span><span class="token number">5</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
  SITE_TO_CHECK<span class="token operator">=</span><span class="token string">&quot;www.baidu.com&quot;</span>
  RET_CODE<span class="token operator">=</span><span class="token string">&#39;curl -I -s --connect-timeout $TIMEOUT $SITE_TO_CHECK -w %{http_code} | tail -n1&#39;</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;x$RET_CODE&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;x200&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;Network OK, will send mail...&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">break</span>
  <span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;Network not ready, wait...&quot;</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token comment">#call ifconfig</span>
cmd<span class="token operator">=</span><span class="token string">&#39;ifconfig&#39;</span>
m<span class="token operator">=</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>cmd<span class="token punctuation">)</span>
t<span class="token operator">=</span>m<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#send result of ifconfigi</span>
m<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
msg<span class="token operator">=</span>MIMEText<span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&#39;plain&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span>
msg<span class="token punctuation">[</span><span class="token string">&#39;From&#39;</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&#39;Raspberry&#39;</span>
msg<span class="token punctuation">[</span><span class="token string">&#39;To&#39;</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">&#39;desticion&#39;</span>
msg<span class="token punctuation">[</span><span class="token string">&#39;Subject&#39;</span><span class="token punctuation">]</span><span class="token operator">=</span>Header<span class="token punctuation">(</span><span class="token string">&#39;Ip Address Report&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#sender email address, replace with your sender email</span>
from_add<span class="token operator">=</span><span class="token string">&#39;xxxxxx@163.com&#39;</span> 
<span class="token comment">#receiver email address, replace with your receiver email</span>
to_add<span class="token operator">=</span><span class="token string">&#39;yyyyyy@qq.com&#39;</span>
<span class="token comment">#pwd of sender email, if return 550 error code ,please use authorization code</span>
password<span class="token operator">=</span><span class="token string">&#39;zzzzzzzzzzzzzzz&#39;</span>
<span class="token comment">#smtp of sender email</span>
smtp_sever<span class="token operator">=</span><span class="token string">&#39;smtp.163.com&#39;</span>
sever<span class="token operator">=</span>smtplib<span class="token punctuation">.</span>SMTP<span class="token punctuation">(</span>smtp_sever<span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span>
sever<span class="token punctuation">.</span>set_debuglevel<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
sever<span class="token punctuation">.</span>login<span class="token punctuation">(</span>from_add<span class="token punctuation">,</span>password<span class="token punctuation">)</span>
sever<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>from_add<span class="token punctuation">,</span><span class="token punctuation">[</span>to_add<span class="token punctuation">]</span><span class="token punctuation">,</span>msg<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sever<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-设置开机执行" tabindex="-1"><a class="header-anchor" href="#_3-设置开机执行"><span>3. 设置开机执行</span></a></h3><p>编辑rc.local文件</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">vim</span> /etc/rc.local
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>将下面命令添加到rc.local文件中</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/sh -e</span>
<span class="token comment">#</span>
<span class="token comment"># rc.local</span>
<span class="token comment">#</span>
<span class="token comment"># This script is executed at the end of each multiuser runlevel.</span>
<span class="token comment"># Make sure that the script will &quot;exit 0&quot; on success or any other</span>
<span class="token comment"># value on error.</span>
<span class="token comment">#</span>
<span class="token comment"># In order to enable or disable this script just change the execution</span>
<span class="token comment"># bits.</span>
<span class="token comment">#</span>
<span class="token comment"># By default this script does nothing.</span>

python /home/leslie/send_email_when_power_on.py

<span class="token builtin class-name">exit</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置执行权限</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> +x /etc/rc.local
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl list-dependencies multi-user.target <span class="token operator">|</span> <span class="token function">grep</span> rc-local
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>输出如下内容：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>● ├─rc-local.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-reboot-检查是否发送成功" tabindex="-1"><a class="header-anchor" href="#_4-reboot-检查是否发送成功"><span>4. reboot 检查是否发送成功</span></a></h3><h2 id="三、vnc实现mac远程连接ubuntu" tabindex="-1"><a class="header-anchor" href="#三、vnc实现mac远程连接ubuntu"><span>三、VNC实现Mac远程连接Ubuntu</span></a></h2>`,24),u={href:"https://zhuanlan.zhihu.com/p/357334969",target:"_blank",rel:"noopener noreferrer"};function d(m,k){const s=e("ExternalLinkIcon");return t(),i("div",null,[r,n("p",null,[n("a",u,[o("参考链接，点击查看"),p(s)])])])}const h=a(l,[["render",d],["__file","开机自动发送邮件.html.vue"]]),g=JSON.parse('{"path":"/tutorial/linux/ubuntu/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6.html","title":"开机自动发送邮件","lang":"zh-CN","frontmatter":{"title":"开机自动发送邮件","author":"Leslie-D","date":"2022-06-08T00:00:00.000Z","star":true,"tag":["Script","Linux","Ubuntu","Android","Python"],"editLink":false,"comment":false,"description":"VNC开机自动执行python脚本发送本机ip地址到指定邮箱 一、背景 问题： 工作中主力机用MacBook，平常有些工具需要用Ubuntu（比如MTK装机软件）。 MacBook切换到Ubuntu主机的时候每次都需要将显示器从MacBook连接到Ubuntu主机上，比较麻烦。 解决方法： Ubuntu每次开机都发送ip地址到指定邮箱，然后在MacBo...","head":[["meta",{"property":"og:url","content":"https://leslie-dd.github.io/leslie-blog/leslie-blog/tutorial/linux/ubuntu/%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6.html"}],["meta",{"property":"og:site_name","content":"Leslie的博客"}],["meta",{"property":"og:title","content":"开机自动发送邮件"}],["meta",{"property":"og:description","content":"VNC开机自动执行python脚本发送本机ip地址到指定邮箱 一、背景 问题： 工作中主力机用MacBook，平常有些工具需要用Ubuntu（比如MTK装机软件）。 MacBook切换到Ubuntu主机的时候每次都需要将显示器从MacBook连接到Ubuntu主机上，比较麻烦。 解决方法： Ubuntu每次开机都发送ip地址到指定邮箱，然后在MacBo..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-17T18:21:17.000Z"}],["meta",{"property":"article:author","content":"Leslie-D"}],["meta",{"property":"article:tag","content":"Script"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:tag","content":"Ubuntu"}],["meta",{"property":"article:tag","content":"Android"}],["meta",{"property":"article:tag","content":"Python"}],["meta",{"property":"article:published_time","content":"2022-06-08T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-17T18:21:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"开机自动发送邮件\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-06-08T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-17T18:21:17.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Leslie-D\\"}]}"]]},"headers":[{"level":2,"title":"一、背景","slug":"一、背景","link":"#一、背景","children":[{"level":3,"title":"问题：","slug":"问题","link":"#问题","children":[]},{"level":3,"title":"解决方法：","slug":"解决方法","link":"#解决方法","children":[]}]},{"level":2,"title":"二、脚本及开机自动执行","slug":"二、脚本及开机自动执行","link":"#二、脚本及开机自动执行","children":[{"level":3,"title":"1. 安装ifconfig","slug":"_1-安装ifconfig","link":"#_1-安装ifconfig","children":[]},{"level":3,"title":"2. 编写发送邮件脚本","slug":"_2-编写发送邮件脚本","link":"#_2-编写发送邮件脚本","children":[]},{"level":3,"title":"3. 设置开机执行","slug":"_3-设置开机执行","link":"#_3-设置开机执行","children":[]},{"level":3,"title":"4. reboot 检查是否发送成功","slug":"_4-reboot-检查是否发送成功","link":"#_4-reboot-检查是否发送成功","children":[]}]},{"level":2,"title":"三、VNC实现Mac远程连接Ubuntu","slug":"三、vnc实现mac远程连接ubuntu","link":"#三、vnc实现mac远程连接ubuntu","children":[]}],"git":{"createdTime":1664720147000,"updatedTime":1713378077000,"contributors":[{"name":"Leslie","email":"LeslieDYF@gmail.com","commits":1}]},"readingTime":{"minutes":1.8,"words":541},"filePathRelative":"tutorial/linux/ubuntu/开机自动发送邮件.md","localizedDate":"2022年6月8日","excerpt":"\\n<h2>一、背景</h2>\\n<h3>问题：</h3>\\n<p>工作中主力机用MacBook，平常有些工具需要用Ubuntu（比如MTK装机软件）。<br>\\nMacBook切换到Ubuntu主机的时候每次都需要将显示器从MacBook连接到Ubuntu主机上，比较麻烦。</p>\\n<h3>解决方法：</h3>\\n<p>Ubuntu每次开机都发送ip地址到指定邮箱，然后在MacBook上用vnc通过ip远程连接Ubuntu（Ubuntu主机接了个HDMI欺骗器，这样远程连接的时候才能显示桌面）</p>\\n<h2>二、脚本及开机自动执行</h2>\\n<h3>1. 安装ifconfig</h3>\\n<p>获取ip地址用到<code>ifconfig</code>这个命令，先在终端试一下有没有安装，没装的话先执行下面命令安装：</p>","autoDesc":true}');export{h as comp,g as data};
