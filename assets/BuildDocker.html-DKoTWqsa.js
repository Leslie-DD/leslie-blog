import{_ as c}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as l,c as r,a as e,d as n,w as i,b as a,e as d}from"./app-B7vEFjvW.js";const p="/leslie-blog/assets/file-tree-DiPBWd4o.png",m={},u={class:"hint-container info"},v=e("p",{class:"hint-container-title"},"背景",-1),k=e("code",null,"Idea 远程部署项目到服务器的 Docker Tomcat",-1),b=e("p",null,"本篇内容主要实现服务器下 Tomcat 的 Docker 镜像创建。",-1),h=d('<h2 id="_1-新建文件夹-目录树如下" tabindex="-1"><a class="header-anchor" href="#_1-新建文件夹-目录树如下"><span>1. 新建文件夹，目录树如下</span></a></h2><p>在~目录下新建 <code>docker-tomcat</code> 文件及其子文件</p><p><img src="'+p+`" alt=""></p><ul><li><p><code>docker-compose-tomcat</code> 用来存储Dockerfile相关的文件</p></li><li><p><code>apache-tomcat-9.0.67.tar.gz</code> tomcat的文件，可以是官网下载的，也可以是自己自定义过的</p></li><li><p><code>jdk-8u281-linux-x64.tar.gz</code> jdk文件，配置tomcat怎么能没有jdk呢</p></li><li><p><code>README.md</code> 写点注释啥的</p></li><li><p><code>Dokcerfile</code> docker build 时会自动寻找这个Dockerfile文件</p></li><li><p><code>docker-tomcat-mapper</code> docker容器中tomcat目录下部分文件在本机的映射，这里只映射了tomcat下两个文件夹：webapps和logs</p></li><li><p><code>webapps</code> 用来部署项目的位置，后面启动镜像的时候会配置</p></li><li><p><code>logs</code> 生成的log都在这个文件夹下，后面启动镜像的时候会配置</p></li></ul><h2 id="_2-编写dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_2-编写dockerfile文件"><span>2. 编写Dockerfile文件</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>FROM ubuntu:latest
MAINTAINER leslie<span class="token operator">&lt;</span>XXXXXX@xxx.com<span class="token operator">&gt;</span>

RUN <span class="token function">mkdir</span> /home/tomcat
<span class="token comment"># 把宿主机当前上下文的README.md拷贝到容器/usr/tomcat/路径下</span>
COPY README.md /home/tomcat/README.md

<span class="token comment"># 把宿主机当前上下文的（也就是当前目录）java与tomcat安装包添加到容器中</span>
ADD apache-tomcat-9.0.67.tar.gz /home/tomcat/
ADD jdk-8u281-linux-x64.tar.gz /home/tomcat/
ADD reading_pictures.tar.gz /root/

<span class="token comment"># 安装vim编辑器</span>
RUN <span class="token function">apt-get</span> update
RUN <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">vim</span>

<span class="token comment"># 设置工作访问时候的MORKDIR路径，登录DE 落脚点</span>
ENV MYPATH /home/tomcat/apache-tomcat-9.0.67
WORKDIR <span class="token variable">$MYPATH</span>

<span class="token comment"># 配置java与tomcat环境变量</span>

<span class="token comment"># 配置java环境</span>
ENV JAVA_HOME /home/tomcat/jdk1.8.0_281
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar <span class="token comment"># 通过冒号隔开</span>

<span class="token comment"># 配置tomcat环境</span>
ENV CATALINA_HOME /home/tomcat/apache-tomcat-9.0.67
ENV CATALINA_BASE /home/tomcat/apache-tomcat-9.0.67

<span class="token comment"># 把上面配置的环境放入到PATH环境变量中</span>
ENV <span class="token environment constant">PATH</span> <span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$CATALINA_HOME</span>/lib:<span class="token variable">$CATALINA_HOME</span>/bin

<span class="token comment"># 容器运行时监听的端口（暴露端口）</span>
EXPOSE <span class="token number">8080</span>
EXPOSE <span class="token number">1099</span>



<span class="token comment"># 启动时运行tomcat</span>
<span class="token comment"># ENTRYPOINT [&quot;/usr/local/apache-tomcat-9.0.67/bin/startup.sh&quot;]</span>
<span class="token comment"># CMD [&quot;/usr/local/apache-tomcat-9.0.67/bin/catalina.sh&quot;,&quot;run&quot;]</span>
CMD /home/tomcat/apache-tomcat-9.0.67/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> <span class="token parameter variable">-F</span> /home/tomcat/apache-tomcat-9.0.67/bin/logs/catalina.out
<span class="token comment"># &amp;&amp; 表示拼接下一条命令，可以无线的拼接。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-构建镜像" tabindex="-1"><a class="header-anchor" href="#_3-构建镜像"><span>3. 构建镜像</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> build <span class="token parameter variable">-t</span> docker-tomcat9 <span class="token builtin class-name">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><p>如果出现timeout问题，可以尝试修改docker的镜像地址为阿里云的。<br> 修改或新建<code>/ect/docker/daemon.json</code>文件,在里面加入阿里云镜像地址</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">{</span>
 <span class="token string">&quot;registry-mirrors&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;https://6kx4zyno.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启docker</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">service</span> <span class="token function">docker</span> restart
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></div><h2 id="_4-启动镜像" tabindex="-1"><a class="header-anchor" href="#_4-启动镜像"><span>4. 启动镜像</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">8081</span>:8080 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">1099</span>:1099 <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span> tomcat9 <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> ~/docker-tomcat/docker-tomcat-mapper/webapps:/home/tomcat/apache-tomcat-9.0.67/webapps <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> ~/docker-tomcat/docker-tomcat-mapper/logs/:/home/tomcat/apache-tomcat-9.0.67/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\\</span>
<span class="token parameter variable">-d</span> tomcat9
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2>`,12),g={href:"https://www.cnblogs.com/liuyuelinfighting/p/16415468.html",target:"_blank",rel:"noopener noreferrer"},_=e("br",null,null,-1),D={href:"https://blog.csdn.net/qq_46153157/article/details/126122042",target:"_blank",rel:"noopener noreferrer"};function f(T,A){const s=o("RouteLink"),t=o("ExternalLinkIcon");return l(),r("div",null,[e("div",u,[v,e("p",null,[n(s,{to:"/tutorial/server/IdeaRemoteDeploy.html"},{default:i(()=>[a("上篇：Idea 部署项目到远程 Tomcat 踩坑")]),_:1}),a(" 搞定后发现服务器主机tomcat占用内存有点大，本着折腾的精神，想看看能否实现 "),k,a("，所以就有了本篇和"),n(s,{to:"/tutorial/server/IdeaRemoteDockerDeploy.html"},{default:i(()=>[a("下篇：Idea 部署项目到远程 Docker Tomcat")]),_:1})]),b]),h,e("p",null,[e("a",g,[a("https://www.cnblogs.com/liuyuelinfighting/p/16415468.html"),n(t)]),_,e("a",D,[a("https://blog.csdn.net/qq_46153157/article/details/126122042"),n(t)])])])}const y=c(m,[["render",f],["__file","BuildDocker.html.vue"]]),N=JSON.parse('{"path":"/tutorial/server/BuildDocker.html","title":"自定义 Tomcat9 Docker 镜像","lang":"zh-CN","frontmatter":{"title":"自定义 Tomcat9 Docker 镜像","author":"Leslie-D","date":"2022-10-03T00:00:00.000Z","tag":["Docker","Tomcat","Linux","Ubuntu","Server"],"editLink":false,"comment":false,"description":"背景 搞定后发现服务器主机tomcat占用内存有点大，本着折腾的精神，想看看能否实现 Idea 远程部署项目到服务器的 Docker Tomcat，所以就有了本篇和 本篇内容主要实现服务器下 Tomcat 的 Docker 镜像创建。 1. 新建文件夹，目录树如下 在~目录下新建 docker-tomcat 文件及其子文件 docker-compose...","head":[["meta",{"property":"og:url","content":"https://leslie-dd.github.io/leslie-blog/leslie-blog/tutorial/server/BuildDocker.html"}],["meta",{"property":"og:site_name","content":"Leslie的博客"}],["meta",{"property":"og:title","content":"自定义 Tomcat9 Docker 镜像"}],["meta",{"property":"og:description","content":"背景 搞定后发现服务器主机tomcat占用内存有点大，本着折腾的精神，想看看能否实现 Idea 远程部署项目到服务器的 Docker Tomcat，所以就有了本篇和 本篇内容主要实现服务器下 Tomcat 的 Docker 镜像创建。 1. 新建文件夹，目录树如下 在~目录下新建 docker-tomcat 文件及其子文件 docker-compose..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-17T18:21:17.000Z"}],["meta",{"property":"article:author","content":"Leslie-D"}],["meta",{"property":"article:tag","content":"Docker"}],["meta",{"property":"article:tag","content":"Tomcat"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:tag","content":"Ubuntu"}],["meta",{"property":"article:tag","content":"Server"}],["meta",{"property":"article:published_time","content":"2022-10-03T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-17T18:21:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"自定义 Tomcat9 Docker 镜像\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2022-10-03T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-17T18:21:17.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Leslie-D\\"}]}"]]},"headers":[{"level":2,"title":"1. 新建文件夹，目录树如下","slug":"_1-新建文件夹-目录树如下","link":"#_1-新建文件夹-目录树如下","children":[]},{"level":2,"title":"2. 编写Dockerfile文件","slug":"_2-编写dockerfile文件","link":"#_2-编写dockerfile文件","children":[]},{"level":2,"title":"3. 构建镜像","slug":"_3-构建镜像","link":"#_3-构建镜像","children":[]},{"level":2,"title":"4. 启动镜像","slug":"_4-启动镜像","link":"#_4-启动镜像","children":[]},{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]}],"git":{"createdTime":1689916613000,"updatedTime":1713378077000,"contributors":[{"name":"Leslie","email":"LeslieDYF@gmail.com","commits":1}]},"readingTime":{"minutes":2.26,"words":677},"filePathRelative":"tutorial/server/BuildDocker.md","localizedDate":"2022年10月3日","excerpt":"<div class=\\"hint-container info\\">\\n<p class=\\"hint-container-title\\">背景</p>\\n<p><a href=\\"/leslie-blog/tutorial/server/IdeaRemoteDeploy.html\\" target=\\"_blank\\">上篇：Idea 部署项目到远程 Tomcat 踩坑</a> 搞定后发现服务器主机tomcat占用内存有点大，本着折腾的精神，想看看能否实现 <code>Idea 远程部署项目到服务器的 Docker Tomcat</code>，所以就有了本篇和<a href=\\"/leslie-blog/tutorial/server/IdeaRemoteDockerDeploy.html\\" target=\\"_blank\\">下篇：Idea 部署项目到远程 Docker Tomcat</a></p>\\n<p>本篇内容主要实现服务器下 Tomcat 的 Docker 镜像创建。</p>\\n</div>","autoDesc":true}');export{y as comp,N as data};
